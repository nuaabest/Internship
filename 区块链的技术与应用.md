作　　者：厉成毅

日　　期：2020.02.23



### 一、区块链用到的密码学技术

#### 1、哈希

**区块链是用的SHA-256哈希函数**

需要有以下三个性质：

**①collision resistance**

将文件进行哈希保证其不会被篡改，尽量不会出现哈希碰撞                  

**②hiding**

哈希函数是单向的，输入空间要很大，分布要均匀                   

**③puzzle friendly**

哈希值的计算结果是无法事先预测的

#### 2、签名

创建一个比特币账户之后，会产生一对公、私钥，签名时用的是私钥，验证的时候用的是公钥。**在比特币中，是先对msg进行一个哈希，然后再对哈希进行签名。**

**挖矿就是：**

每个区块会有一个block header，在这个部分内部会有一个nonce的区域，这个区域是一个随机数，会把随机数带入哈希函数参与运算，要计算的结果小于等于target，假设所有的输出空间是L，target只是前面的很少一部分，挖矿没有捷径，只能进行无数次的计算



### 二、比特币需要的数据结构

首先需要理解一下**哈希指针（hash pointers）**的含义，普通指针只是保存一下结构体在内存的位置，但是哈希指针还需要保存该结构体的哈希值

#### 1、区块链

![](C:\Users\Administrator\Desktop\block_link.png)

左边第一个的区块是最开始的（genesis block），最右边的是最近产生的区块（most recent block）

这里的H( )用来表示前面一个区块的哈希指针，每个区块都会保留前一个区块的哈希指针，是由前一个区块的所有内容通过哈希形成的，最近产生的区块也会有一个它的哈希指针存在，存在于系统之中，可以通过这个哈希指针判断之前的数据是否有被修改。

#### 2、Merkle tree

***区块是可以分为下面两个部分的：block header（只保留有root hash值）和block body（这个里面保留有具体的交易的各种信息）***

Merkle tree和binary tree的区别在于是用哈希指针还是普通指针（**我并不确定是否是唯一区别**）

区块链有两种节点：`全节点`和`轻节点`

​				   全节点是存有完整区块链副本的设备

​				   轻节点是只包含区块block header部分的设备

Merkle tree可以提供***Merkle proof***（即指一个交易到root hash的路径），可以判断一个交易是否存在于该Mekle tree中

![](C:\Users\Administrator\Desktop\Merkle_tree.png)

对于某些轻节点，不会存有全部信息，仅仅包含block header，只有一个哈希值而已，可以通过下面的方式进行判断：
　　首先该按轻节点向全节点发出一个请求，请求一个Makle proof，请求的这个Makle proof需要包含要查看的tx叶节点，全节点收到请求之后会把倒数第一行的H()（红色）发送给轻节点，轻节点通过把自己的本地哈希值和全节点发送过来的一起进行运算会得到倒数第二行的H()（绿色本地的），然后全节点会把另一个H()（红色）发过来，继续这种运算，最后得到一个最后的root hash，再与区块中的root bash进行比较，结果不一样就证明该交易不存在。